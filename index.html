<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>Frea Search YoRHa UI</title>
  <link rel='stylesheet' href='./font.css'><link rel="stylesheet" href="./style.css">
</head>

<body>
<!-- partial:index.partial.html -->
<header>
  <div class="pattern">
    <div class="container">
      <div class="pattern-inner"></div>
    </div>
  </div>
  
  <div class="container">
    <div style="float: left;">
      <h1>
        <span>Frea Search</span>
        <small> YoRHa UI</small>
      </h1>
    </div>
    <div style="float: right;padding-right: 100px;padding-top: 26px;">
      <input class="full" id="query" name="query" type="text" placeholder="YoRHa No2 Type B" onkeypress="enter();"/>
      <button type="submit" onclick="submit()">Search</button>
    </div>
  </div>
</header>

<main>
  <div id="result" class="container">
  </div>
  <div id="loading" class="loader" >
    <h2 name="status" style="text-align: center; padding-top: 100px;">Search something...</h2>
  </div>
</main>

<div class="pattern">
  <div class="container">
    <div class="pattern-inner"></div>
  </div>
</div>
<!-- partial -->
  
</body>

<script>
let url = new URL(window.location.href);
let params = url.searchParams;
document.getElementsByName('query')[0].value = params.get('q');
document.getElementsByName('status')[0].textContent = "Search something...";

if (params.get('q')){
  search();
}

function enter(){
  if( window.event.keyCode == 13 ){
    submit();
  }
}

function submit(){
  const base_url = location.protocol + '//' + location.host + location.pathname;
  const query = document.getElementById('query').value
  window.location.href = base_url + '?q=' + query
}

function search() {
  const query = params.get('q')
  document.getElementsByName('status')[0].textContent = "Loading...";

  fetch(`https://freasearch.org/search?q=${query}&format=json`)
  .then(function (data) {
    return data.json();
  })
  .then(function (api_result) {
    console.log(api_result);

    for (var i = 0; i < api_result.results.length; i++) {
      var div = document.createElement('div');
      div.className = 'content';

      var link = document.createElement('a');
      link.href = api_result.results[i].url;

      var domain = document.createElement('small');
      domain.textContent = api_result.results[i].parsed_url[1];

      var title = document.createElement('h3');
      title.textContent = api_result.results[i].title;

      var context = document.createElement('p');
      context.textContent = api_result.results[i].content;

      div.appendChild(domain);
      link.appendChild(title);
      div.appendChild(link);
      div.appendChild(context);
      document.getElementById('result').appendChild(div);
    }
  })
}
</script>

</html>